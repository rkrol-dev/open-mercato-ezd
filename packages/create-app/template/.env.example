# Example environment configuration
# Copy this file to .env and adjust values for your environment.

# PostgreSQL Configuration
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=open-mercato
POSTGRES_PORT=5432

# PostgreSQL connection string (required)
DATABASE_URL=postgres://postgres:postgres@localhost:5432/open-mercato

# JWT secret for auth tokens (required)
JWT_SECRET=change-me-dev-secret

# Events transport (choose one)
# REDIS_URL=redis://localhost:6379
# or
# EVENTS_REDIS_URL=redis://localhost:6379

# Email provider (optional)
# RESEND_API_KEY=

# Public URL used in emails and onboarding flows
APP_URL=http://localhost:3000

# Enable self-service onboarding (default: false)
SELF_SERVICE_ONBOARDING_ENABLED=false
DEMO_MODE=true

# Admin email to notify about onboarding submissions
ADMIN_EMAIL=ops@your-domain.com

# Node environment
NODE_ENV=development

# Auto-spawn workers when starting the app (default: true)
# Set to false to run workers separately in production
AUTO_SPAWN_WORKERS=true

# Base directory for local file-backed queues (default: ./.mercato/queue)
QUEUE_BASE_DIR=./.mercato/queue

# SSL Certificate Configuration
# Path to additional CA certificates for Node.js HTTPS connections
# Required for Raiffeisen Bank API which doesn't send complete certificate chain
# The GeoTrust EV RSA CA G2 intermediate certificate is needed for SSL verification
# Certificate valid until: July 2, 2030
# To update: curl -o certs/geotrust-ev-rsa-ca-g2.pem https://cacerts.digicert.com/GeoTrustEVRSACAG2.crt.pem
NODE_EXTRA_CA_CERTS=./certs/geotrust-ev-rsa-ca-g2.pem

# Hybrid query engine SQL logging (optional, default: false)
# Set to true to log raw SQL statements from the hybrid query engine.
QUERY_ENGINE_DEBUG_SQL=false

# Enable tree profiler for matching resources/entities (comma-separated filters, e.g. * - for all profilers,customers.*, customers.people)
# OM_PROFILE=
# Enable detailed CRUD profiling for matching resources (comma-separated filters, e.g. customers.*, *)
# OM_CRUD_PROFILE=
# Enable hybrid query engine profiling for matching entities (comma-separated filters, e.g. customers.*, customers.people)
# OM_QE_PROFILE=

# Enable cache for CRUD API responses (default: false)
ENABLE_CRUD_API_CACHE=false

# Auto-reindex query indexes when coverage gaps are detected (default: true)
SCHEDULE_AUTO_REINDEX=true

# Skip immediate coverage recalculation on read (default: false)
OPTIMIZE_INDEX_COVERAGE_STATS=false

# Continue serving results from entity indexes when coverage gaps are detected (default: true)
FORCE_QUERY_INDEX_ON_PARTIAL_INDEXES=true

# Hashed search tokenization defaults
OM_SEARCH_ENABLED=true
OM_SEARCH_MIN_LEN=3
OM_SEARCH_ENABLE_PARTIAL=true
OM_SEARCH_HASH_ALGO=sha256
OM_SEARCH_STORE_RAW_TOKENS=false
# Optional comma-separated blocklist of field name substrings to skip during tokenization
# OM_SEARCH_FIELD_BLOCKLIST=password,token,secret,hash

# Search module debug logging (Meilisearch, vector search, reindex operations)
OM_SEARCH_DEBUG=false

# Query index engine debug logging (search:source-has-tokens, coverage, etc.)
OM_QUERY_INDEX_DEBUG=false

# Toggle EAV backward compatibility for user-defined entities (custom field values)
# When true, DataEngine will also write to custom_field_values on create/update of custom entities.
# Default is false: values are only stored in custom_entities_storage.
ENTITIES_BACKCOMPAT_EAV_FOR_CUSTOM=false

# Cache strategy (default: memory)
CACHE_STRATEGY=sqlite

# Default TTL in milliseconds (optional)
CACHE_TTL=300000

# Redis Configuration
#REDIS_PORT=6379

# Redis configuration (for redis strategy)
#CACHE_REDIS_URL=redis://localhost:6379

# SQLite configuration (for sqlite strategy)
CACHE_SQLITE_PATH=./data/cache.db

# JSON file configuration (for jsonfile strategy)
#CACHE_JSON_FILE_PATH=./data/cache.json

# Database pooling settings
DB_POOL_MIN=5
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT=30000
DB_POOL_ACQUIRE_TIMEOUT=60000

# Audit log retention windows
# Core resources (users, roles) keep access history longer to support investigations.
AUDIT_LOGS_CORE_RETENTION_DAYS=7
# Non-core reads rotate aggressively to limit storage.
AUDIT_LOGS_NON_CORE_RETENTION_HOURS=8

# Tenant data encryption (enabled by default)
TENANT_DATA_ENCRYPTION=yes
TENANT_DATA_ENCRYPTION_DEBUG=false
# Preferred fallback key when Vault is unavailable (use a strong 32+ char secret)
TENANT_DATA_ENCRYPTION_FALLBACK_KEY=dev-tenant-encryption-fallback-key-32chars
# Legacy secondary fallback secret (optional)
TENANT_DATA_ENCRYPTION_KEY=
# Hashicorp Vault configuration
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=dev-only-token
VAULT_KV_PATH=secret/data

# ============================================================================
# Embedding Provider Configuration (for vector search)
# ============================================================================
# Vector search requires ONE embedding provider to be configured.
# OpenAI is the default provider if no explicit configuration is set.

# OpenAI (default embedding provider)
# Models: text-embedding-3-small (1536 dim), text-embedding-3-large (3072 dim)
OPENAI_API_KEY=your_openai_api_key_here

# Google Generative AI
# Models: text-embedding-004 (768 dim), embedding-001 (768 dim)
# GOOGLE_GENERATIVE_AI_API_KEY=

# Mistral AI
# Models: mistral-embed (1024 dim)
# MISTRAL_API_KEY=

# Cohere
# Models: embed-english-v3.0 (1024 dim), embed-multilingual-v3.0 (1024 dim)
# COHERE_API_KEY=

# Amazon Bedrock
# Models: amazon.titan-embed-text-v2:0 (1024 dim), cohere.embed-english-v3 (1024 dim)
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_REGION=us-east-1

# Ollama (Local/Self-hosted)
# Models: nomic-embed-text (768 dim), mxbai-embed-large (1024 dim), all-minilm (384 dim)
# Default: http://localhost:11434 (no /api suffix needed)
# OLLAMA_BASE_URL=http://localhost:11434

# ============================================================================
# OCR (Optical Character Recognition) Configuration
# ============================================================================
# Default OCR model for image and PDF text extraction (optional)
# Falls back to 'gpt-4o' if not specified. Can be overridden per partition.
# Supported models: gpt-4o, gpt-4o-mini
OCR_MODEL=gpt-4o

# Custom OCR prompt (optional, advanced)
# Override the default prompt sent to the LLM for text extraction
# OCR_DEFAULT_PROMPT="Extract all text content from this image..."

# Enable/disable OCR for new partitions by default (default: true)
# OPENMERCATO_DEFAULT_ATTACHMENT_OCR_ENABLED=true

# ============================================================================
# OpenCode AI Assistant Configuration
# ============================================================================
# OpenCode handles AI requests for the AI Assistant feature.
# Configure the provider and set the corresponding API key.

# Provider selection: anthropic, openai, or google (default: anthropic)
OPENCODE_PROVIDER=anthropic

# Optional: Override the default model for the selected provider
# Default models by provider:
#   - anthropic: claude-haiku-4-5-20251001
#   - openai: gpt-4o-mini
#   - google: gemini-2.0-flash
# OPENCODE_MODEL=anthropic/claude-sonnet-4-20250514

# Provider API keys (set the one matching OPENCODE_PROVIDER)
OPENCODE_ANTHROPIC_API_KEY=your_anthropic_api_key_here
# OPENCODE_OPENAI_API_KEY=your_openai_api_key_here
# OPENCODE_GOOGLE_API_KEY=your_google_api_key_here

# ============================================================================
# Meilisearch Configuration (for hybrid search)
# ============================================================================
# Meilisearch provides fast full-text fuzzy search capabilities.
# When configured, it becomes the primary search strategy.
# If not configured, the system falls back to token-based search.

# Meilisearch server URL (required for Meilisearch strategy)
# MEILISEARCH_HOST=http://localhost:7700

# Meilisearch API key (required for production, optional for development)
# MEILISEARCH_API_KEY=your_master_key_here

# Index prefix for tenant isolation (default: om)
# MEILISEARCH_INDEX_PREFIX=om
