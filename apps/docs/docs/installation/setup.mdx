---
title: Local setup
description: Step-by-step checklist to run Open Mercato locally.
---

## Getting started tracks

**Recommended: follow the develop branch track.** It contains the latest monorepo setup and is the default path for active development.

:::tip Windows users
If you are on **Windows**, skip the native setup and jump straight to the [Docker development setup](#docker-development-setup) below. It runs the entire stack — app, database, Redis, and search — inside containers, so you don't need Node.js, Yarn, or native build tools installed on your machine. This is also a great option for any platform where you prefer a fully containerized workflow.
:::

[![Watch on YouTube](https://img.youtube.com/vi/OsalmbiWQ-I/maxresdefault.jpg)](https://youtu.be/OsalmbiWQ-I)

### Develop branch (recommended)

```bash
git clone https://github.com/open-mercato/open-mercato.git
cd open-mercato
git checkout develop
```

Continue with the develop setup steps below.

### Docker-based setup (all platforms)

Use this track if you want to run the **entire stack inside Docker** with hot reload — no local Node.js or Yarn required. This is the **recommended path for Windows** and works on macOS/Linux too.

See the [full Docker Development Setup](#docker-development-setup) section below for step-by-step instructions.

## Develop setup steps (recommended)

Follow these steps after the [prerequisites](./prerequisites) are in place:

1. **Use the develop branch**
   ```bash
   cd open-mercato
   git checkout develop
   ```
2. **Start Docker services**
   ```bash
   docker compose up -d
   ```
   This starts PostgreSQL 15 with pgvector and Redis 7. The pgvector extension is automatically installed, enabling vector search features.

3. **Install workspace dependencies**
   ```bash
   yarn install
   ```
4. **Copy the environment template**
   ```bash
   cp apps/mercato/.env.example apps/mercato/.env
   ```
   Make sure these required variables are set in `apps/mercato/.env` before continuing:
   ```env
   DATABASE_URL=postgres://postgres:postgres@localhost:5432/open-mercato
   JWT_SECRET=change-me-dev-secret
   REDIS_URL=redis://localhost:6379
   ```
   If you prefer a separate events Redis, set `EVENTS_REDIS_URL` instead of `REDIS_URL`.
5. **Build packages and generate registries**
   ```bash
   yarn build:packages
   yarn generate
   ```
6. **Bootstrap data**
   ```bash
   yarn initialize
   ```
   This script prepares module registries, generates/applies migrations, seeds default roles, provisions an admin user, and loads demo CRM data (companies, people, deals, activities, todos). Add `--no-examples` if you prefer to skip the demo content while keeping core identities, `--stresstest` (optionally with `-n <count>`) to preload thousands of synthetic contacts, companies, deals, activities, and notes, or combine `--stresstest --lite` for high-volume contacts without the heavier extras when you need raw throughput.
7. **Launch the app**
   ```bash
   yarn dev
   ```
   Navigate to `http://localhost:3000/backend` and sign in with the credentials printed by `yarn initialize`.

## Docker Management

**Stop services:**
```bash
docker compose down
```

**View logs:**
```bash
docker compose logs -f
```

**Complete reset (deletes all data):**
```bash
docker compose down -v
docker compose up -d
yarn mercato init
```

**Verify pgvector installation:**
```bash
docker exec mercato-postgres psql -U postgres -d open-mercato -c "SELECT extname, extversion FROM pg_extension WHERE extname = 'vector';"
```

## Docker Development Setup

Run the entire Open Mercato stack inside Docker **with hot reload**. Source code is mounted from the host so every file change is picked up automatically — no local Node.js, Yarn, or native build tools required. This is the **recommended setup for Windows** and a convenient option on any OS.

### Prerequisites

- **Docker Desktop** — [Download for Windows](https://docs.docker.com/desktop/setup/install/windows-install/), [macOS](https://docs.docker.com/desktop/setup/install/mac-install/), or [Linux](https://docs.docker.com/desktop/setup/install/linux/)
- Docker Compose v2+ (bundled with Docker Desktop)
- **Git** — [Download for Windows](https://git-scm.com/download/win) (includes Git Bash)
- At least **4 GB RAM** allocated to Docker (check Docker Desktop → Settings → Resources)

:::info Windows-specific notes
- Use **Git Bash**, **PowerShell**, or **Windows Terminal** for running commands.
- When cloning the repo, make sure Git preserves line endings for shell scripts:
  ```bash
  git config --global core.autocrlf input
  ```
- In Docker Desktop, ensure **WSL 2 backend** is enabled (Settings → General → "Use the WSL 2 based engine"). This is required for volume mounts and file watching to work correctly.
:::

### Quick Start

```bash
# Clone the repository
git clone https://github.com/open-mercato/open-mercato.git
cd open-mercato
git checkout develop

# (Optional) Copy and customize environment
cp apps/mercato/.env.example apps/mercato/.env

# Build and start the full dev stack
docker compose -f docker-compose.fullapp.dev.yml up --build
```

The first run takes several minutes — Docker builds the image, installs dependencies, builds packages, runs migrations, and seeds demo data. Subsequent starts are much faster because initialization is cached in a named volume.

Once the logs show the Next.js dev server is ready, open `http://localhost:3000/backend` and sign in with the default credentials printed during initialization (typically `admin@example.com` / `password`).

### How It Works

The `docker-compose.fullapp.dev.yml` file orchestrates five services:

| Service | Image | Purpose |
|---------|-------|---------|
| **app** | Built from `Dockerfile` (dev stage) | Next.js app with hot reload |
| **postgres** | `pgvector/pgvector:pg17-trixie` | PostgreSQL 17 with pgvector |
| **redis** | `redis:7-alpine` | Caching and event persistence |
| **meilisearch** | `getmeili/meilisearch:v1.11` | Full-text search |
| **opencode** | Custom | Claude Code integration (optional) |

The app container:
- **Mounts your source code** from the host into `/app`
- Uses **named volumes** for `node_modules`, `.next`, and package `dist/` directories so the container manages its own builds
- Enables **file-watching via polling** (`CHOKIDAR_USEPOLLING`, `WATCHPACK_POLLING`) for reliable change detection on all platforms
- On first run, executes `yarn mercato init` (migrations + seeding); on subsequent runs, applies pending migrations only

### Common Operations

**Start in detached mode (background):**
```bash
docker compose -f docker-compose.fullapp.dev.yml up -d
```

**View logs:**
```bash
docker compose -f docker-compose.fullapp.dev.yml logs -f        # all services
docker compose -f docker-compose.fullapp.dev.yml logs -f app    # app only
```

**Rebuild after pulling new changes:**
```bash
docker compose -f docker-compose.fullapp.dev.yml up --build
```

**Stop all services:**
```bash
docker compose -f docker-compose.fullapp.dev.yml down
```

**Full reset (deletes all data and cached builds):**
```bash
docker compose -f docker-compose.fullapp.dev.yml down -v
docker compose -f docker-compose.fullapp.dev.yml up --build
```

### Environment Variables

All environment variables are pre-configured with sensible defaults inside the compose file. To customize, edit `apps/mercato/.env` before starting — the compose file reads from it automatically.

Key variables you may want to override:

| Variable | Default | Description |
|----------|---------|-------------|
| `APP_PORT` | `3000` | Host port for the app |
| `POSTGRES_USER` | `postgres` | Database username |
| `POSTGRES_PASSWORD` | `postgres` | Database password |
| `JWT_SECRET` | `JWT` | Auth token secret |
| `OPENAI_API_KEY` | — | Required for vector search and AI features |
| `DEMO_MODE` | `true` | Seeds demo CRM data on first run |

### Troubleshooting

**Container fails to start on Windows:**
- Ensure WSL 2 backend is enabled in Docker Desktop
- Check that the repository was cloned with `core.autocrlf=input` to avoid CRLF issues in shell scripts
- Verify Docker Desktop has enough memory allocated (4 GB minimum)

**File changes not detected:**
- The compose file sets `CHOKIDAR_USEPOLLING=true` and `WATCHPACK_POLLING=true` by default. If changes are still not picked up, restart the app container:
  ```bash
  docker compose -f docker-compose.fullapp.dev.yml restart app
  ```

**Port conflicts:**
- If port 3000 is already in use, override it: `APP_PORT=3001 docker compose -f docker-compose.fullapp.dev.yml up`

**Slow file watching on Windows/WSL 2:**
- Store the repository inside the WSL 2 filesystem (`\\wsl$\Ubuntu\home\...`) rather than on the Windows filesystem (`/mnt/c/...`) for significantly better I/O performance.

---

## Docker Deployment (Full Stack)

Run the complete Open Mercato stack with Docker Compose, including the application, PostgreSQL, Redis, and Meilisearch. This approach is ideal for quick demos, testing, or containerized deployments.

[![Watch: Deploy Open Mercato on a VPS](https://img.youtube.com/vi/xau17YBP9ek/maxresdefault.jpg)](https://www.youtube.com/watch?v=xau17YBP9ek)

### Prerequisites

- Docker 24+ and Docker Compose v2+
- At least 4GB RAM available for Docker
- Configured `.env` file (see Environment Variables below)

### Quick Start

```bash
# Clone the repository
git clone https://github.com/open-mercato/open-mercato.git
cd open-mercato

# Copy environment template
cp apps/mercato/.env.example apps/mercato/.env

# Edit apps/mercato/.env with your configuration (see next section)

# Build and start all services
docker compose -f docker-compose.fullapp.yml up --build
```

The application will be available at `http://localhost:3000/backend`. Sign in with the default admin credentials printed during initialization (typically `admin@example.com`).

### Environment Variables

Before starting the Docker stack, configure `apps/mercato/.env` with at least these required variables:

```env
# Database (container uses these to initialize PostgreSQL)
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=open-mercato
DATABASE_URL=postgres://postgres:postgres@postgres:5432/open-mercato

# Authentication (generate a strong secret for production)
JWT_SECRET=your-secure-jwt-secret-change-me

# Application
APP_URL=http://localhost:3000
NODE_ENV=development

# Caching
CACHE_REDIS_URL=redis://redis:6379
CACHE_STRATEGY=redis

# Search (optional but recommended)
MEILISEARCH_HOST=http://meilisearch:7700
MEILISEARCH_API_KEY=meilisearch-dev-key
MEILISEARCH_MASTER_KEY=meilisearch-dev-key

# AI Features (optional)
OPENAI_API_KEY=sk-your-openai-key
```

**Note:** The container hostnames (`postgres`, `redis`, `meilisearch`) match the service names in `docker-compose.fullapp.yml`.

### Common Operations

**Start services in detached mode:**
```bash
docker compose -f docker-compose.fullapp.yml up -d
```

**View logs from all services:**
```bash
docker compose -f docker-compose.fullapp.yml logs -f
```

**View logs from app only:**
```bash
docker compose -f docker-compose.fullapp.yml logs -f app
```

**Rebuild after code changes:**
```bash
docker compose -f docker-compose.fullapp.yml up --build
```

**Stop all services:**
```bash
docker compose -f docker-compose.fullapp.yml down
```

**Stop and remove volumes (deletes all data):**
```bash
docker compose -f docker-compose.fullapp.yml down -v
```

**Restart a specific service:**
```bash
docker compose -f docker-compose.fullapp.yml restart app
```

### Data Persistence

Data is stored in named Docker volumes:
- `mercato-postgres-data` - PostgreSQL database
- `mercato-redis-data` - Redis cache and events
- `mercato-meilisearch-data` - Meilisearch indexes

Volumes persist between container restarts unless explicitly removed with `docker compose down -v`.

**Backup volumes:**
```bash
# Backup PostgreSQL
docker exec mercato-postgres pg_dump -U postgres open-mercato > backup.sql

# Restore PostgreSQL
cat backup.sql | docker exec -i mercato-postgres psql -U postgres -d open-mercato
```

### Production Deployment Tips

When deploying to production environments, consider these recommendations:

**Security:**
- Generate a strong, unique `JWT_SECRET` (use `openssl rand -base64 32`)
- Use strong, random passwords for `POSTGRES_PASSWORD` and `MEILISEARCH_MASTER_KEY`
- Never expose database or Redis ports directly to the internet
- Consider using Docker secrets or external secret management (Vault, AWS Secrets Manager)

**Infrastructure:**
- Use managed database services (AWS RDS, Google Cloud SQL, Azure Database) instead of containerized PostgreSQL for production workloads
- Consider managed Redis (AWS ElastiCache, Redis Cloud) for better reliability
- Set up a reverse proxy (nginx, Traefik) with SSL/TLS termination
- Use Docker Swarm or Kubernetes for orchestration and scaling
- Configure resource limits for containers (CPU, memory)

**Monitoring & Operations:**
- Enable health checks for all services (already configured in docker-compose.fullapp.yml)
- Set up log aggregation (ELK stack, Loki, CloudWatch)
- Monitor container resource usage and disk space
- Configure automated backups for volumes
- Test restore procedures regularly

**Application Configuration:**
- Set `NODE_ENV=production` in production environments
- Configure proper `APP_URL` with your domain
- Review and set optional environment variables for AI, email, and integrations
- Consider external Meilisearch for better search performance at scale

### Troubleshooting

**Container fails to start:**
```bash
# Check logs for errors
docker compose -f docker-compose.fullapp.yml logs app

# Verify environment variables
cat apps/mercato/.env

# Check if ports are already in use
lsof -i :3000
lsof -i :5432
lsof -i :6379
```

**Database connection errors:**
```bash
# Verify PostgreSQL is running
docker compose -f docker-compose.fullapp.yml ps postgres

# Check if database exists
docker exec mercato-postgres psql -U postgres -c "\l"

# Verify DATABASE_URL matches container configuration
grep DATABASE_URL apps/mercato/.env
```

**Build errors:**
```bash
# Clean build cache
docker compose -f docker-compose.fullapp.yml build --no-cache

# Remove old images
docker image prune -a
```

**Out of disk space:**
```bash
# Check Docker disk usage
docker system df

# Clean up unused resources
docker system prune -a --volumes
```

**Reset everything:**
```bash
# Stop and remove all containers, networks, and volumes
docker compose -f docker-compose.fullapp.yml down -v

# Rebuild from scratch
docker compose -f docker-compose.fullapp.yml up --build
```

### Architecture Overview

The `docker-compose.fullapp.yml` stack includes:

- **app** - Open Mercato application (Node.js 24, Next.js)
- **postgres** - PostgreSQL 17 with pgvector extension
- **redis** - Redis 7 for caching and event persistence
- **meilisearch** - Meilisearch v1.11 for full-text search
- **opencode** - Claude Code integration (optional)

Services communicate via a dedicated Docker network (`mercato-network-fullapp`) and use health checks to ensure proper startup order.

For advanced/manual flows (custom migration control, selective seeding, etc.) see the CLI reference in the repository README.
